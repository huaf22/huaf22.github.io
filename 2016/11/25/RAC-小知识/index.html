<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>  · Hexo</title><meta name="description" content=" - Afluy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/images/avatar.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.afluy.site/atom.xml" title="Hexo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="images/avatar.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="https://github.com/huaf22" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="http://www.jianshu.com/users/86344ec5bfe7/latest_articles" target="_blank" class="nav-list-link">简书</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title"></h1><div class="post-info">Nov 25, 2016</div><div class="post-content"><h2 id="RAC-小知识"><a href="#RAC-小知识" class="headerlink" title="RAC-小知识"></a>RAC-小知识</h2><a id="more"></a>
<p><img src="https://kevinhm.gitbooks.io/functionalreactiveprogrammingonios/content/images/MVVM_high_level.png" alt="在MVVM中，我们趋向于将view和view controller作为一个整体,
新的viewModel代替原来的viewController协调view与model之间的交互。"></p>
<blockquote>
<p>通过将定制的业务逻辑放置于视图模型中，我避免了视图控制器的臃肿化，视图控制器仅需要根据视图模型的协议来知道如何显示即可。 MVVM是子类化视图控制器的一个很好的选择。</p>
</blockquote>
<p>VieModel 中不是只有属性, 也包含处理数据的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RAC(imageView, image) = [RACObserve(self.photoModel, fullsizeData) map:^id (id value)&#123;</div><div class="line">	return [UIImage imageWithData:value];</div><div class="line">&#125;];</div><div class="line">这样就将UIImageView的image属性和数据模型photoModel的fullsizeData属性进行了绑定</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">在任意的ViewModel中将相关的属性和View控件相绑定</div><div class="line">@property (nonatomic, strong ) FRPPhotoModel *photoModel;</div><div class="line"></div><div class="line">RAC(self.imageView, image) = [[RACObserve(self, photoModel.thumbnailData) ignore:nil]</div><div class="line">	map:^(NSData *data)&#123;</div><div class="line">		return [UIImage imageWithData:data];</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">注意看我们观察的是self的photoModel.thumbnailData的关键路径，而非self.photoModel的thumbnailData的关键路径。</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">[SVProgressHUD show];</div><div class="line">//Fetch data</div><div class="line">[[FRPPhotoImporter fetchPhotoDetails:self.photoModel]</div><div class="line">        subscribeError:^(NSError * error)&#123;</div><div class="line">            [SVProgressHUD showErrorWithStatus:@&quot;Error&quot;];</div><div class="line">        &#125;</div><div class="line">        completed:^&#123;</div><div class="line">            [SVProgressHUD dismiss];</div><div class="line">        &#125;];</div><div class="line"></div><div class="line">+ (RACReplaySubject *)fetchPhotoDetails:(FRPPhotoModel *)photoModel &#123;</div><div class="line">    RACReplaySubject * subject = [RACReplaySubject subject];</div><div class="line">    NSURLRequest *request = [self photoURLRequest:photoModel];</div><div class="line"></div><div class="line">    [NSURLConnection sendAsynchronousRequest:request</div><div class="line">        queue:[NSOperationQueue mainQueue]</div><div class="line">        completionHandler:^ (NSURLResponse *response, NSData * data, NSError *connectionError)&#123;</div><div class="line">            if(data)&#123;</div><div class="line">                id results = [NSJSONSerialization JSONObjectWithData:data options:0 error:nil][ @&quot;photo&quot; ];</div><div class="line"></div><div class="line">                [self configurePhotoModel:photoModel withDictionary:results];</div><div class="line">                [self downloadFullsizedImageForPhotoModel:photoModel];</div><div class="line"></div><div class="line">                [subject sendNext:photoModel];</div><div class="line">                [subject sendCompleted];</div><div class="line">            &#125;</div><div class="line">            else&#123;</div><div class="line">                [subject sendError:connectionError];</div><div class="line">            &#125;</div><div class="line">        &#125;];</div><div class="line"></div><div class="line">    return subject;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">RACSignal *photoSignal = [FRPPhotoImporter importPhotos];</div><div class="line">RACSignal *photosLoaded = [photoSignal catch:^RACSignal *(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Couldn&apos;t fetch photos from 500px : %@&quot;,error);</div><div class="line">    return [RACSignal empty];</div><div class="line">&#125;];</div><div class="line">RAC(self, photosArray) = photosLoaded;</div><div class="line">[photosLoaded subscribeCompleted: ^&#123;</div><div class="line">    @strongify(self);</div><div class="line">    [self.conllectionView reloadData];</div><div class="line">&#125;];</div><div class="line">比起subscribeError: 方法，catch: 方法处理的更为巧妙：它允许无错误值的信号穿透它，仅在信号有错误事件发生时才会调用它的block并发送其在发生错误时的返回值。这里我们使用catch:</div><div class="line">方法，来过滤无错误的值。</div><div class="line"></div><div class="line">上面的代码等效于:</div><div class="line">RAC(self, photosArray) = [[[[FRPPhotoImporter importPhotos]</div><div class="line">        doCompleted:^&#123;</div><div class="line">            @strongify(self);</div><div class="line">            [self.collectionView reloadData];</div><div class="line">        &#125;] logError] catchTo:[RACSignal empty]];</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">+ (RACSignal *)fetchPhotoDetails:(FRPPhotoModel *)photoModel &#123;</div><div class="line">    NSURLRequest *request = [self photoURLRequest:photoModel];</div><div class="line">    return [[[[[[NSURLConnection rac_sendAsynchronousRequest:request]</div><div class="line">                                map:^id(RACTuple *value)&#123;</div><div class="line">                                    return [value second];</div><div class="line">                                &#125;]</div><div class="line">                                deliverOn:[RACScheduler mainThreadScheduler]]</div><div class="line">                                    map:^id (NSData *data) &#123;</div><div class="line">                                        id results = [NSJSONSerialization JSONObjectWithData:data</div><div class="line">                                                                       options:0 error:nil][@&quot;photo&quot;];</div><div class="line">                                        [self configurePhotoModel:photoModel withDictionary:results];</div><div class="line">                                        [self downloadFullsizedImageForPhotoModel:photoModel];</div><div class="line">                                        return photoModel;</div><div class="line">                                    &#125;] publish] autoconnect];</div><div class="line">&#125;</div><div class="line"></div><div class="line">publish返回一个RACMulitcastConnection,当信号连接上时，他将订阅该接收信号。autoconnect为我们做的是：当它返回的信号被订阅，连接到 该(订阅背后的)信号（underly signal）。</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">有一个禅宗佛教的概念叫做&quot;初心&quot;。禅宗法师[铃木俊隆]写道：&quot;初学者的心中有很多可能性（潜意识的点子），但在专家心里(这种可能性/点子)就相对少很多&quot;。</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2016/11/25/配置-fastlane-遇到的问题/" class="prev">PREV</a><a href="/2016/11/25/[RxJava学习笔记]-变换的基础方法--lift/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://www.afluy.site">Afluy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>